<script>
  const form = document.getElementById('dataForm');
  const list = document.getElementById('messagesList');

  form.addEventListener('submit', async (e) => {
    e.preventDefault();
    const formData = new FormData(form);
    const data = Object.fromEntries(formData.entries());

    await fetch('/.netlify/functions/index/submit', {
      method: 'POST',
      headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
      body: new URLSearchParams(data),
    });

    form.reset();
    loadMessages();
  });

  async function loadMessages() {
    const res = await fetch('/.netlify/functions/index/data');
    const messages = await res.json();

    list.innerHTML = '';
    messages.forEach(({ name, message, timestamp }) => {
      const item = document.createElement('li');
      item.textContent = `${name} (${new Date(timestamp).toLocaleString()}): ${message}`;
      list.appendChild(item);
    });
  }

  loadMessages();
</script>
